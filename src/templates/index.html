<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">
<head>
    <title>–ó–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/style/style.css"/>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="/static/js/handler.js"></script>
    <script>
        var store = {
          files: {},
        };

        app_pages = {
            main:  {},
            files: {},
        }

        window.addEventListener("load", (event) => {
                app.run('main');
                loadUploader();
        });

        function loadUploader() {
            var script = document.createElement('script');
            script.src = '/static/js/uploader.js';
            document.body.appendChild(script);
        }

        document.addEventListener('DOMContentLoaded', function () {

        app = new handler({
          store: store,
          container: "#app",
          pages: app_pages,
          url: window.location.origin + window.location.pathname
        });

        Handlebars.registerHelper("incremented", function (index) {
            return index + 1;
        });

        app.addHandler("main", (data)=> {
            app.go("main");
        })

        app.addHandler("files", (data)=> {
           app.go("files");
        })
    })
    </script>
</head>
<body>
<div id="content">
    <section id="app">
        –ó–∞–≥—Ä—É–∂–∞–µ–º
    </section>
</div>

<template id="main">
    <h1>–ó–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤</h1>
    <div id="dropArea">
        <p>
            <br><br><br><br>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –∑–æ–Ω—É<br><br><br><br>
        </p>
    </div>
    <form>
        <input name="file" multiple type="file"
               accept="text/csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
        <button type="submit" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </form>

    <progress value="0" max="100"></progress>
    <p>
        <strong>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:</strong>
        <span id="statusMessage">ü§∑‚Äç‚ôÇ –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</span>
    </p>

    <p>
        <strong>–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:</strong>
        <span id="fileNum">0</span>
    </p>

    <ul id="fileListMetadata"></ul>
</template>


<template id="files">
    <div class="container">
        <section>
            <h1 class="center">–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h1>
            <p class="center">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.</p>
            <div class="center">
                <div class="alert mb" onclick="redirect('/riddle')"><span class="name">Riddle App</span></div>
                <div class="alert mb" onclick="redirect('/trivia')"><span class="name">Trivia App</span></div>
                <div class="alert mb" onclick="redirect('/chat')"><span class="name">Chat App</span></div>
            </div>
        </section>
    </div>
</template>

<div id="button">
    <button id="go_main" class="tappable block" onclick="app.run('main')">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</button>
    <button id="go_files" class="tappable block" onclick="app.run('files')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
</div>

<script>

    const button_main = document.getElementById('go_main');
    button_main.addEventListener('click', function(){ loadUploader();}, false);


<!--    const content = document.getElementById('content');-->
<!--    const config = {attributes: false, childList: true, subtree: true };-->
<!--    var observer = new MutationObserver(function(mutations) {-->
<!--      mutations.forEach(function(mutation) {-->
<!--        if (mutation.type === "childList" && mutation.target.id === "app") {-->
<!--            {-->
<!--               console.log(`The ${mutation.target.id} was modified.`);-->
<!--               loadUploader();-->
<!--            }-->
<!--        }-->
<!--        else if (mutation.type === "attributes") {-->
<!--            console.log(`The ${mutation.attributeName} attribute was modified.`);-->
<!--        }-->
<!--      });-->
<!--    });-->
<!--    observer.observe(content, config);-->

</script>
</body>
</html>