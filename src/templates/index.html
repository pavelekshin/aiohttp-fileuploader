<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">
<head>
    <title>–ó–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/style/style.css"/>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="/static/js/handler.js"></script>
    <script>
        var store = {
          files: {},
        };

        app_pages = {
            main:  {},
            files: {},
        }

        window.addEventListener("load", (event) => {
                app.run('main');
                loadUploader();
        });

        function loadUploader() {
            var script = document.createElement('script');
            script.src = '/static/js/uploader.js';
            document.body.appendChild(script);
        }

        document.addEventListener('DOMContentLoaded', function () {

        app = new handler({
          store: store,
          container: "#app",
          pages: app_pages,
          url: window.location.origin + window.location.pathname
        });

        Handlebars.registerHelper("incremented", function (index) {
            return index + 1;
        });

        app.addHandler("main", (data)=> {
            app.go("main");
        })

        app.addHandler("files", (data)=> {
            app.store.files = data;
            app.go('files');
            var remoteFiles = document.getElementById("remoteFiles");
            console.log(data)
            renderFilesResponse(data);
        });
    });

    function httpGetFiles(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.responseType = 'json';
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200)
                callback.run('files', xhr.response);
        }
        xhr.open("GET", url, true); // true for asynchronous
        xhr.send();
    };
    </script>
</head>
<body>
<div id="content">
    <section id="app">
        –ó–∞–≥—Ä—É–∂–∞–µ–º
    </section>
</div>

<template id="main">
    <h1>–ó–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤</h1>
    <div id="dropArea">
        <p>
            <br><br><br><br>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –∑–æ–Ω—É<br><br><br><br>
        </p>
    </div>
    <form>
        <input name="file" multiple type="file"
               accept="text/csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
        <button type="submit" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </form>

    <progress value="0" max="100"></progress>
    <p>
        <strong>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:</strong>
        <span id="statusMessage">ü§∑‚Äç‚ôÇ –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</span>
    </p>

    <p>
        <strong>–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:</strong>
        <span id="fileNum">0</span>
    </p>

    <ul id="fileListMetadata"></ul>
</template>


<template id="files">
    <h1 class="center">–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏</h1>
    <ul>
        <strong>–§–∞–π–ª | </strong>
        <strong>–°–æ–∑–¥–∞–Ω | </strong>
        <strong>C—Ç—Ä–æ–∫ | </strong>
        <strong>–°—Ç–∞—Ç—É—Å </strong>
    </ul>
    <ul id="remoteFiles"></ul>
</template>

<div id="button">
    <button id="go_main" class="tappable block" onclick="app.run('main')">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</button>
    <button id="go_files" class="tappable block"
            onclick="httpGetFiles(window.location.origin + '/files', app)">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    </button>
</div>

<script>
    const button_main = document.getElementById('go_main');
    button_main.addEventListener('click', function(){ loadUploader();}, false);
</script>
</body>
</html>